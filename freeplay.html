<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Infinite Road Modern</title>
<style>
body{margin:0;overflow:hidden;background:#000;}
</style>
</head>
<body>

<script type="module">

import * as THREE from 'https://unpkg.com/three@0.160.0/build/three.module.js';
import { GLTFLoader } from 'https://unpkg.com/three@0.160.0/examples/jsm/loaders/GLTFLoader.js';

const scene = new THREE.Scene();
scene.background = new THREE.Color(0x2244ff);

const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 500);
camera.position.set(0,3,10);

const renderer = new THREE.WebGLRenderer({
  antialias:false,
  powerPreference:"high-performance"
});
renderer.setPixelRatio(Math.min(devicePixelRatio,2));
renderer.setSize(innerWidth,innerHeight);
renderer.outputColorSpace = THREE.SRGBColorSpace;
renderer.toneMapping = THREE.ACESFilmicToneMapping;
renderer.toneMappingExposure = 2.0;
document.body.appendChild(renderer.domElement);

// Lighting
scene.add(new THREE.AmbientLight(0xffffff,2));
const key = new THREE.DirectionalLight(0xffffff,3);
key.position.set(5,10,5);
scene.add(key);
const fill = new THREE.DirectionalLight(0xffffff,1.5);
fill.position.set(-5,5,-5);
scene.add(fill);

// Road
const ROAD_LENGTH = 40;
const ROAD_COUNT  = 6;
const SPEED = 0.4;

const roads = [];
const geo = new THREE.PlaneGeometry(8,ROAD_LENGTH);
const mat = new THREE.MeshStandardMaterial({color:0x222222});

for(let i=0;i<ROAD_COUNT;i++){
  const r = new THREE.Mesh(geo,mat);
  r.rotation.x = -Math.PI/2;
  r.position.z = -i*ROAD_LENGTH;
  scene.add(r);
  roads.push(r);
}

// Load Model
let model;
const loader = new GLTFLoader();

loader.load("scene.glb", (gltf)=>{

  model = gltf.scene;

  model.traverse(obj=>{
    if(obj.isMesh){
      obj.material.metalness = 0.2;
      obj.material.roughness = 0.6;
      obj.material.needsUpdate = true;
    }
  });

  // Auto-scale
  const box = new THREE.Box3().setFromObject(model);
  const size = new THREE.Vector3();
  box.getSize(size);
  const maxDim = Math.max(size.x,size.y,size.z);
  const scale = 6/maxDim;
  model.scale.setScalar(scale);

  const center = new THREE.Vector3();
  box.getCenter(center);
  model.position.x = -center.x * scale;
  model.position.y = -box.min.y * scale;
  model.position.z = -40;

  scene.add(model);

});

// Animate
function animate(){
  requestAnimationFrame(animate);

  for(const r of roads){
    r.position.z += SPEED;
    if(r.position.z > 20){
      r.position.z -= ROAD_LENGTH*ROAD_COUNT;
    }
  }

  if(model){
    model.position.z += SPEED;
    if(model.position.z > 20){
      model.position.z = -80;
    }
  }

  renderer.render(scene,camera);
}
animate();

window.addEventListener("resize",()=>{
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});

</script>
</body>
</html>